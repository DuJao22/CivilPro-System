<!-- Sistema SaaS CiviPro | Desenvolvido por João Layon - Full Stack -->
{% extends "base.html" %}

{% block title %}{{ project.name }} - CiviPro{% endblock %}
{% block page_title %}{{ project.name }}{% endblock %}

{% block content %}
<div class="mb-4">
  <a href="{{ url_for('projects_list') }}" class="text-blue-600 dark:text-blue-400 hover:underline">← Voltar aos projetos</a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <div class="card">
    <div class="flex justify-between items-start mb-4">
      <h3 class="text-lg font-bold">Informações do Projeto</h3>
      <span class="px-3 py-1 rounded text-sm
        {% if project.status == 'em_andamento' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200
        {% elif project.status == 'concluido' %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200
        {% else %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200{% endif %}">
        {% if project.status == 'em_andamento' %}Em Andamento
        {% elif project.status == 'concluido' %}Concluído
        {% elif project.status == 'pausado' %}Pausado
        {% else %}Em Andamento{% endif %}
      </span>
    </div>
    <div class="space-y-2">
      <p><strong>Cliente:</strong> {{ project.client or '-' }}</p>
      <p><strong>Tipo:</strong> 
        {% if project.project_type == 'residencial' %}Residencial
        {% elif project.project_type == 'comercial' %}Comercial
        {% elif project.project_type == 'industrial' %}Industrial
        {% else %}Residencial{% endif %}
      </p>
      <p><strong>Área:</strong> {{ project.area }} m²</p>
      <p><strong>Nível de Acabamento:</strong> {{ project.finish_level|title }}</p>
      <p><strong>Prazo:</strong> {{ project.deadline or '-' }}</p>
      {% if project.real_cost and project.real_cost > 0 %}
      <p><strong>Custo Real:</strong> R$ {{ "%.2f"|format(project.real_cost) }}</p>
      {% endif %}
      <p><strong>Criado em:</strong> {{ project.created_at[:10] }}</p>
      {% if project.notes %}
      <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
        <p class="font-bold mb-2">Observações:</p>
        <p class="text-sm whitespace-pre-wrap">{{ project.notes }}</p>
      </div>
      {% endif %}
    </div>
  </div>
  
  <div class="card">
    <h3 class="text-lg font-bold mb-4">Ações</h3>
    <div class="space-y-2">
      <form method="POST" action="{{ url_for('generate_budget', project_id=project.id) }}">
        <button type="submit" class="w-full px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Gerar Orçamento</button>
      </form>
      {% if budget %}
      <a href="{{ url_for('export_pdf', project_id=project.id) }}" class="block w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-center">Exportar PDF</a>
      {% endif %}
      <a href="{{ url_for('project_edit', project_id=project.id) }}" class="block w-full px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 text-center">Editar Projeto</a>
      <form method="POST" action="{{ url_for('project_delete', project_id=project.id) }}" onsubmit="return confirm('Tem certeza que deseja excluir este projeto?')">
        <button type="submit" class="w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Excluir Projeto</button>
      </form>
    </div>
  </div>
</div>

<div class="mt-6 card">
  <h3 class="text-lg font-bold mb-4">Orçamento</h3>
  
  {% if budget %}
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead>
        <tr class="border-b border-gray-200 dark:border-gray-700">
          <th class="text-left py-2">Material</th>
          <th class="text-right py-2">Quantidade</th>
          <th class="text-left py-2">Unidade</th>
          <th class="text-right py-2">Custo (R$)</th>
        </tr>
      </thead>
      <tbody>
        {% for item in budget %}
        <tr class="border-b border-gray-100 dark:border-gray-800">
          <td class="py-2">{{ item.material }}</td>
          <td class="text-right py-2">{{ item.quantity }}</td>
          <td class="py-2">{{ item.unit }}</td>
          <td class="text-right py-2">{{ "%.2f"|format(item.cost) }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr class="font-bold">
          <td colspan="3" class="text-right py-2">Total:</td>
          <td class="text-right py-2">R$ {{ "%.2f"|format(total) }}</td>
        </tr>
      </tfoot>
    </table>
  </div>
  {% else %}
  <p class="text-gray-500 dark:text-gray-400">Nenhum orçamento gerado ainda. Clique em "Gerar Orçamento" acima.</p>
  {% endif %}
</div>
{% endblock %}
