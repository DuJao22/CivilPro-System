<!-- Sistema SaaS CiviPro | Desenvolvido por João Layon - Full Stack -->
{% extends "base.html" %}

{% block title %}Editar Projeto - CiviPro{% endblock %}
{% block page_title %}Editar Projeto{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
  <div class="mb-4">
    <a href="{{ url_for('project_view', project_id=project.id) }}" class="text-blue-600 dark:text-blue-400 hover:underline">← Voltar ao projeto</a>
  </div>

  <div class="card">
    <h2 class="text-2xl font-bold mb-6">Editar Projeto</h2>
    
    <form method="POST">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2">Nome do Projeto *</label>
          <input type="text" name="name" value="{{ project.name }}" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Cliente</label>
          <select name="client_id" id="clientSelect" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Selecione um cliente (opcional)</option>
            {% for client in clients %}
            <option value="{{ client.id }}" {% if project.client_id == client.id %}selected{% endif %}>{{ client.name }}{% if client.phone %} - {{ client.phone }}{% endif %}</option>
            {% endfor %}
            <option value="new" {% if not project.client_id and project.client %}selected{% endif %}>+ Novo Cliente (digitar nome)</option>
          </select>
          <input type="text" name="client_name" id="clientNameInput" placeholder="Nome do novo cliente" value="{% if not project.client_id %}{{ project.client or '' }}{% endif %}" class="{% if project.client_id %}hidden{% endif %} w-full px-3 py-2 mt-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <script>
          document.getElementById('clientSelect').addEventListener('change', function() {
            const input = document.getElementById('clientNameInput');
            if (this.value === 'new') {
              input.classList.remove('hidden');
              input.required = true;
            } else {
              input.classList.add('hidden');
              input.required = false;
            }
          });
        </script>
        
        <div>
          <label class="block text-sm font-medium mb-2">Área (m²) *</label>
          <input type="number" step="0.01" name="area" value="{{ project.area }}" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Tipo de Obra</label>
          <select name="project_type" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="residencial" {% if project.project_type == 'residencial' %}selected{% endif %}>Residencial</option>
            <option value="comercial" {% if project.project_type == 'comercial' %}selected{% endif %}>Comercial</option>
            <option value="industrial" {% if project.project_type == 'industrial' %}selected{% endif %}>Industrial</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Nível de Acabamento</label>
          <select name="finish" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="simples" {% if project.finish_level == 'simples' %}selected{% endif %}>Simples</option>
            <option value="medio" {% if project.finish_level == 'medio' %}selected{% endif %}>Médio</option>
            <option value="alto" {% if project.finish_level == 'alto' %}selected{% endif %}>Alto</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Status</label>
          <select name="status" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="em_andamento" {% if project.status == 'em_andamento' %}selected{% endif %}>Em Andamento</option>
            <option value="pausado" {% if project.status == 'pausado' %}selected{% endif %}>Pausado</option>
            <option value="concluido" {% if project.status == 'concluido' %}selected{% endif %}>Concluído</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Prazo</label>
          <input type="date" name="deadline" value="{{ project.deadline or '' }}" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Custo Real (R$)</label>
          <input type="number" step="0.01" name="real_cost" value="{{ project.real_cost or 0 }}" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2">Observações</label>
          <textarea name="notes" rows="4" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">{{ project.notes or '' }}</textarea>
        </div>
      </div>
      
      <div class="flex gap-4 mt-6">
        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Salvar Alterações</button>
        <a href="{{ url_for('project_view', project_id=project.id) }}" class="px-6 py-2 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-700">Cancelar</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}
